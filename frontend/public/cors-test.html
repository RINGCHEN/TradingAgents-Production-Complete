<!DOCTYPE html>
<html>
<head>
    <title>CORS 測試頁面</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>🧪 CORS 測試頁面</h1>
    <button id="test-btn" onclick="testAPI()">測試 API 連接</button>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9;"></div>

    <script>
    async function testAPI() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '⏳ 測試中...';

        try {
            console.log('🚀 開始測試 API...');
            
            // 測試 1: 基本 GET 請求
            const response = await fetch('https://twshocks-app-79rsx.ondigitalocean.app/api/simple-portfolios', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Authorization': 'Bearer temp-token'
                },
                mode: 'cors'
            });

            console.log('📡 HTTP 狀態:', response.status);
            console.log('📋 回應標頭:', [...response.headers.entries()]);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            console.log('✅ API 回應:', data);

            resultDiv.innerHTML = `
                <h3>✅ 成功！</h3>
                <p><strong>狀態:</strong> ${response.status} ${response.statusText}</p>
                <p><strong>回應:</strong></p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
                <p><strong>CORS 標頭:</strong></p>
                <pre>Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}</pre>
            `;

        } catch (error) {
            console.error('❌ API 測試失敗:', error);
            resultDiv.innerHTML = `
                <h3>❌ 失敗！</h3>
                <p><strong>錯誤:</strong> ${error.message}</p>
                <p><strong>類型:</strong> ${error.constructor.name}</p>
                <p>請檢查開發者工具的 Network 標籤查看詳細信息</p>
            `;
        }
    }

    // 頁面載入時顯示當前域名
    document.addEventListener('DOMContentLoaded', function() {
        const infoDiv = document.createElement('div');
        infoDiv.innerHTML = `
            <h2>🔍 當前環境信息</h2>
            <p><strong>當前域名:</strong> ${window.location.origin}</p>
            <p><strong>用戶代理:</strong> ${navigator.userAgent}</p>
            <p><strong>測試時間:</strong> ${new Date().toLocaleString()}</p>
        `;
        document.body.insertBefore(infoDiv, document.getElementById('result'));
    });
    </script>
</body>
</html>