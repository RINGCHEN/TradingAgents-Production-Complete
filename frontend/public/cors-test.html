<!DOCTYPE html>
<html>
<head>
    <title>CORS æ¸¬è©¦é é¢</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>ğŸ§ª CORS æ¸¬è©¦é é¢</h1>
    <button id="test-btn" onclick="testAPI()">æ¸¬è©¦ API é€£æ¥</button>
    <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9;"></div>

    <script>
    async function testAPI() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = 'â³ æ¸¬è©¦ä¸­...';

        try {
            console.log('ğŸš€ é–‹å§‹æ¸¬è©¦ API...');
            
            // æ¸¬è©¦ 1: åŸºæœ¬ GET è«‹æ±‚
            const response = await fetch('https://twshocks-app-79rsx.ondigitalocean.app/api/simple-portfolios', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Authorization': 'Bearer temp-token'
                },
                mode: 'cors'
            });

            console.log('ğŸ“¡ HTTP ç‹€æ…‹:', response.status);
            console.log('ğŸ“‹ å›æ‡‰æ¨™é ­:', [...response.headers.entries()]);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            console.log('âœ… API å›æ‡‰:', data);

            resultDiv.innerHTML = `
                <h3>âœ… æˆåŠŸï¼</h3>
                <p><strong>ç‹€æ…‹:</strong> ${response.status} ${response.statusText}</p>
                <p><strong>å›æ‡‰:</strong></p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
                <p><strong>CORS æ¨™é ­:</strong></p>
                <pre>Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}</pre>
            `;

        } catch (error) {
            console.error('âŒ API æ¸¬è©¦å¤±æ•—:', error);
            resultDiv.innerHTML = `
                <h3>âŒ å¤±æ•—ï¼</h3>
                <p><strong>éŒ¯èª¤:</strong> ${error.message}</p>
                <p><strong>é¡å‹:</strong> ${error.constructor.name}</p>
                <p>è«‹æª¢æŸ¥é–‹ç™¼è€…å·¥å…·çš„ Network æ¨™ç±¤æŸ¥çœ‹è©³ç´°ä¿¡æ¯</p>
            `;
        }
    }

    // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºç•¶å‰åŸŸå
    document.addEventListener('DOMContentLoaded', function() {
        const infoDiv = document.createElement('div');
        infoDiv.innerHTML = `
            <h2>ğŸ” ç•¶å‰ç’°å¢ƒä¿¡æ¯</h2>
            <p><strong>ç•¶å‰åŸŸå:</strong> ${window.location.origin}</p>
            <p><strong>ç”¨æˆ¶ä»£ç†:</strong> ${navigator.userAgent}</p>
            <p><strong>æ¸¬è©¦æ™‚é–“:</strong> ${new Date().toLocaleString()}</p>
        `;
        document.body.insertBefore(infoDiv, document.getElementById('result'));
    });
    </script>
</body>
</html>